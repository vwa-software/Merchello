@inherits Merchello.Web.Mvc.MerchelloViewPage<IPublishedContent>
@using Merchello.Core.Models
@using Merchello.Web
@using Merchello.Web.Store.Localization
@using System;
@using ClientDependency.Core.Mvc;

@{
	Layout = "Master.cshtml";

	Html.RequiresJs("~/Scripts/vwa_account.js", 4);

	ICustomer customer = null;
	if (CurrentCustomer is ICustomer)
	{
		customer = (ICustomer)CurrentCustomer;
	}

	var umbracomember = Members.GetCurrentMember();

	IPublishedContent account = Umbraco.TypedContent(1112);

	if (customer != null)
	{
		var companyName = umbracomember.GetPropertyValue("company");
		var phone = umbracomember.GetPropertyValue("phoneHome");
		var firstLetters = @umbracomember.GetPropertyValue("customerInitials");

		<div class="hk_order hk_checkout">
			@if (Model.HasProperty("brief") && Model.HasValue("brief"))
			{
				@Umbraco.Field("brief")
			}
			<div class="row">

				<div class="col-md-12 ">
					@if (!customer.WishList().IsEmpty)
					{
						<h2 class="hk_shop">@StoreFormsResource.LabelWishList</h2>
						@Html.Action("WishListForm", "StoreWishList", new { area = "Merchello" })
					}

					<div class="row">
						@if (account != null)
						{
							@account.GetGridHtml(Html, "gridLayout")
						}
					</div>

					<!----------  agent block  -------->
					@*
						<div class="row">
							<div class="col-md-4 offset-md-9" style="padding:1%; border: 2px solid #8080804a">
								<p><strong>your saleagent</strong></p>
								<p>Best agetur </p>
								<span>bessagentur.no</span>   <span style="padding-left: 10%;">elisabeth@bessagentur.no </span>
							</div>
						</div>
					*@

					<!----------  account tabs  -------->
					<h2 class="hk_shop">Account</h2>
					<div class="row">
						<div class="col-lg-8 col-md-12">
							<ul class="nav nav-tabs tabsTop" role="tablist">
								<li class="nav-item">
									<a class="nav-link active show account-tab" href="" role="tab" data-toggle="tab" aria-selected="true">my account</a>
								</li>
								<li class="nav-item">
									<a class="nav-link invoice-tab" href="" role="tab" data-toggle="tab">invoice address</a>
								</li>
								<li class="nav-item">
									<a class="nav-link shipping-tab" href="" role="tab" data-toggle="tab" aria-selected="true">shipping address</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="" role="tab" data-toggle="tab" aria-selected="true">complaint form</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="" role="tab" data-toggle="tab" aria-selected="true">productfeed</a>
								</li>
							</ul>
						</div>

						<!----------  button row -------->
						<div class="col-md-3 col-lg-2 hide-mobile custom-padding">
							<button class="btn newFormBtn">Request new</button>
						</div>

						<div class="col-lg-2 col-md-3 hide-mobile custom-padding">
							<button class="btn editFormBtn">Request edit</button>
						</div>
					</div>

					<!----------  account tabs contents -------->
					<div class="tab-content tab-account-content tabContentTop">
						<div class="col-md-12 tab-pane  in active show" role="tabpanel" id="account">
							<div class="row">
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-company="@companyName">
									<strong>company name</strong>
									<br />
									@if (Members.IsLoggedIn())
									{
										@umbracomember.GetPropertyValue("company")
									}
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-lastname="@string.Format("{0}", customer.LastName)">
									<strong>last name</strong>
									<br />@string.Format("{0}", customer.LastName)
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-country="">
									<strong>country</strong>
									<br />
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-zip="">
									<strong>zipcode</strong>
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-mobile="">
									<strong>mobile</strong>
									<br />
								</div>
							</div>

							<div class="row">
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-firstname="@string.Format("{0}", customer.FirstName)">
									<strong>first name</strong>
									<br />@string.Format("{0}", customer.FirstName)
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-email="@customer.Email">
									<strong>email adress</strong>
									<br />
									<a href="mailto:@customer.Email">@customer.Email</a>
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-province="">
									<strong>province</strong>
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-city="">
									<strong>city</strong>
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3">
								</div>
							</div>

							<div class="row">
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-firstLetters="@firstLetters">
									<strong>first letters</strong>
									<br /> @umbracomember.GetPropertyValue("customerInitials")
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-gender="">
									<strong>gender</strong>
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-street="">
									<strong>street + nr.</strong>
									<br />
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 dataCol" data-phone="@phone">
									<strong>phone</strong>
									<br />
									@phone
								</div>
								<div class="col-lg-2 col-md-2 col-sm-3 col-xs-3">
								</div>
							</div>
						</div>

						<div class="col-md-12 tab-pane in" role="tabpanel" id="invoice_address">
							@Html.Action("GetAllBillingAddresses", "CustomerMembership", new { area = "FastTrack" })
						</div>

						<div class="col-md-12 tab-pane " role="tabpanel" id="shipping_address">
							@Html.Action("GetAllShippingAddresses", "CustomerMembership", new { area = "FastTrack" })
						</div>

						<div class="col-md-12 tab-pane in" role="tabpanel" id="complaint">
							<div class="form-group">
								<p>type of complaint*</p>
								<select class="mdb-select md-form">
									<option value="mGoods">complaint form missing goods/wrong delivered goods</option>
									<option value="dGoods">complaint form damaged goods</option>
								</select>
							</div>
							<div class="col-md-12" id="option1">
								@Umbraco.RenderMacro("renderUmbracoForm", new { FormGuid = "5f43119c-c1ed-4758-98c9-9570d890b0d4", FormTheme = "bootstrap3-horizontal", ExcludeScripts = "1" })
							</div>
							<div class="col-md-12" id="option2">
								@Umbraco.RenderMacro("renderUmbracoForm", new { FormGuid = "5cbbccbf-a31d-4fe7-adbc-44300d6ef9c5", FormTheme = "bootstrap3-horizontal", ExcludeScripts = "1" })
							</div>
						</div>
						<div class="col-md-12 tab-pane in" role="tabpanel" id="productfeed">
							<!---------- TODO get ALL cvs customer has -------->
							@umbracomember.GetPropertyValue("productfeedUrlCsv")
						</div>
					</div>

					<div class="tab-content editAccount">
						@Umbraco.RenderMacro("renderUmbracoForm", new { FormGuid = "cda0d77d-03b0-4411-863f-b2591c79efa7", FormTheme = "new-theme", ExcludeScripts = "1" })
					</div>
					<div class="col-md-3 col-lg-2">
						<button class="btn cancelBtn cancelAcc" style="float:left;">Cancel</button>
					</div>
				</div>

				<!----------  button row -------->
				<div class="row">
					<div class="col-xs-3 col-sm-6 hide-desktop">
						<button class="btn newFormBtn">Request new</button>
					</div>

					<div class="col-xs-3 col-sm-6 hide-desktop">
						<button class="btn editFormBtn">Request edit</button>
					</div>
				</div>

				<div class="row" style="margin:20px 0px 0px 0px">
					<div class="col-md-12">
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<ul class="nav nav-tabs" role="tablist">
							<li class="nav-item">
								<a class="nav-link active show" href="#history" role="tab" data-toggle="tab" aria-selected="true">my web order history</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#orders" role="tab" data-toggle="tab">my order history</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#invoices" role="tab" data-toggle="tab" aria-selected="true">my invoices</a>
							</li>
						</ul>

						<div class="tab-content">
							<div class="col-md-12 tab-pane fade in active show" role="tabpanel" id="history">
								@Html.Action("CustomerSalesHistory", "CustomerMembership", new { area = "FastTrack" })
							</div>
							<div class="col-md-12 tab-pane fade in" role="tabpanel" id="invoices">
								@Html.Action("Invoices", "Account", new { area = "ETCConnector" })
							</div>
							<div class="col-md-12 tab-pane fade" role="tabpanel" id="orders">
								@Html.Action("Orders", "Account", new { area = "ETCConnector" })
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	}
	else
	{
		// customer == null, for some reason.
		<script type="text/javascript">
			window.location = "/home";
		</script>
	}
}

@section Scripts {

	<script>
		$(function () {
			if ($('.umbraco-forms-submitmessage').length) {
				$('.umbraco-forms-submitmessage').get(0).scrollIntoView();
			}
		})
	</script>
}